# 電子天秤シミュレータ使用説明書

## 概要
このアプリケーションは、検品デスクトップアプリのテスト用に3台の電子天秤をシミュレートするソフトウェアです。

## 機能
- 3台の電子天秤の重量値を個別に設定
- TCP/IPソケット通信でコマンドを受信
- EK-iシリーズ互換のプロトコルで応答
- リアルタイム通信ログ表示

## 使用方法

### 1. 起動準備
1. シミュレータを起動
2. 各天秤の初期重量を設定（デフォルト: 0.00g）

### 2. サーバー開始
1. 「サーバー開始」ボタンをクリック
2. ポート 9001, 9002, 9003 で接続待機開始
3. 緑色で「サーバー稼働中」と表示されることを確認

### 3. 重量設定
- 天秤1～3の重量欄に数値を入力
- 「設定」ボタンで重量を更新
- 単位はグラム（g）

### 4. 検品アプリとの接続

#### オプション1: 検品アプリの設定変更
検品アプリの設定ファイルでシリアルポートの代わりにTCP接続を使用:

```json
{
  "Balances": [
    {
      "LogicalName": "Pre_10mm",
      "PortName": "127.0.0.1:9001",
      "BaudRate": 9600,
      "Protocol": "TCP"
    },
    {
      "LogicalName": "Post_1mm", 
      "PortName": "127.0.0.1:9002",
      "BaudRate": 9600,
      "Protocol": "TCP"
    },
    {
      "LogicalName": "Post_5mm",
      "PortName": "127.0.0.1:9003", 
      "BaudRate": 9600,
      "Protocol": "TCP"
    }
  ]
}
```

#### オプション2: 仮想COMポート使用
Virtual Serial Port Emulator等で仮想COMポートペアを作成:
- COM1 ⟷ TCP:localhost:9001
- COM2 ⟷ TCP:localhost:9002  
- COM3 ⟷ TCP:localhost:9003

### 5. 通信プロトコル

#### 受信コマンド
- `Q`: 重量問い合わせ
- `Z` or `ZERO`: ゼロ点調整
- `T` or `TARE`: 風袋引き

#### 応答フォーマット
- 正常: `ST,GS,+0123.45g`
- エラー: `ST,ES,Unknown Command`

## トラブルシューティング

### ポートが使用できない
- 他のアプリケーションがポートを使用していないか確認
- WindowsファイアウォールでTCPポート 9001-9003 を許可

### 接続できない
1. サーバーが「稼働中」状態か確認
2. 通信ログで接続状況を確認
3. ネットワーク設定を確認

### 重量が反映されない
1. 重量設定後に「設定」ボタンを押下したか確認
2. 通信ログで`Q`コマンドの送受信を確認

## 開発者向け情報

### ポート構成
- Balance1 (投入前10mm): TCP Port 9001
- Balance2 (投入後1mm): TCP Port 9002  
- Balance3 (投入後5mm): TCP Port 9003

### プロトコル詳細
EK-iシリーズ電子天秤互換:
- コマンド終端: CR+LF
- 応答終端: CR+LF
- 重量フォーマット: 符号付き7桁 (+0000.00g)

### ログファイル
通信ログはアプリ内でのみ表示（ファイル保存なし）