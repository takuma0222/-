# 従業員NOチェック機能 - クイックリファレンスガイド

## 機能概要
従業員NO（6桁）を入力すると、自動的にCSVファイルから氏名を検索して表示する機能です。

---

## 基本的な使い方

### 1. 従業員NOを入力
```
┌────────────────────────────┐
│ 従業員No: [123456]         │  ← 6桁の数字を入力
│           山田太郎          │  ← 自動で氏名が表示される
│ カードNo: [活性化]         │  ← カードNo入力可能になる
└────────────────────────────┘
```

**動作**:
- 6桁目を入力した瞬間に自動検索
- ボタン押下は不要
- 検索中は「読み込み中...」と表示
- 該当する氏名が青文字で表示される

---

### 2. 該当しない従業員NOの場合
```
┌────────────────────────────┐
│ 従業員No: [     ]          │  ← 自動クリアされる
│           該当するユーザがありません。│  ← 赤文字で表示
│ カードNo: [非活性]         │
└────────────────────────────┘
```

**動作**:
- 赤文字で「該当するユーザがありません。」と表示
- 入力欄が自動的にクリアされる
- フォーカスが従業員NO欄に戻る
- カードNOは非活性のまま

---

## 入力ルール

### ✅ 許可される入力
- **数字のみ**: 0-9
- **桁数**: 6桁固定
- **例**: 123456, 000001, 999999

### ❌ 許可されない入力
- アルファベット（入力不可）
- 記号（入力不可）
- 5桁以下（検索されない）
- 7桁以上（MaxLength制限で入力不可）

---

## エラー時の表示

### ファイル読み取りエラー
```
メッセージ: "データ読み取りエラーが発生しました"
```

**原因**:
- CSVファイルが見つからない
- ファイルが開けない（別のプログラムで開いている等）
- ファイル形式が不正

**対処**:
1. `data\employees.csv` ファイルが存在するか確認
2. ファイルが正しいUTF-8形式か確認
3. ログファイル（`logs\error\[日付].log`）で詳細を確認

---

## CSVファイル仕様

### ファイル配置場所
```
BalanceInspection.exe と同じフォルダ
└── data
    └── employees.csv
```

### ファイル形式
```csv
EmployeeNo,Name
123456,山田太郎
234567,佐藤花子
345678,鈴木一郎
```

**仕様**:
- 文字コード: UTF-8
- 区切り文字: カンマ (,)
- 改行コード: LF または CRLF
- 1行目: ヘッダー（固定: `EmployeeNo,Name`）
- 2行目以降: データ

### Excelでの編集方法
1. Excelで `employees.csv` を開く
2. データを編集（従業員NO追加/変更/削除）
3. 「名前を付けて保存」→「CSV UTF-8（コンマ区切り）(*.csv)」
4. **重要**: アプリケーションを再起動してデータを反映

---

## ログ確認方法

### ログファイルの場所
```
BalanceInspection.exe と同じフォルダ
└── logs
    └── error
        └── 2025-11-05.log  ← 日付別ログファイル
```

### ログの内容

**検索成功時**:
```
[2025-11-05 10:30:45.123] 従業員検索成功: 123456 - 山田太郎
```

**該当なし時**:
```
[2025-11-05 10:31:20.456] 従業員検索失敗: 従業員NO 999999 が見つかりません
```

**エラー時**:
```
[2025-11-05 10:32:10.789] 従業員検索エラー: CSV file not found: C:\...\data\employees.csv
   at EmployeeLoader.LoadAsync() in ...
```

---

## よくある質問（FAQ）

### Q1: 氏名が表示されない
**A**: 以下を確認してください
1. 従業員NOが6桁の数字か
2. CSVファイルに該当データがあるか
3. ログファイルでエラーを確認

### Q2: 「該当するユーザがありません。」と表示される
**A**: CSVファイルに該当する従業員NOが登録されていません。
- `data\employees.csv` を開いて従業員NOを追加してください
- アプリケーションを再起動して再読み込みしてください

### Q3: 従業員データを更新したが反映されない
**A**: アプリケーションを再起動してください。
- CSVデータは起動時/初回検索時に読み込まれます
- 実行中の更新は反映されません

### Q4: アルファベットや記号が入力できない
**A**: 仕様です。従業員NOは数字のみ入力可能です。

### Q5: 「読み込み中...」が表示されたまま
**A**: 以下の原因が考えられます
1. CSVファイルが非常に大きい（数万行以上）
2. ファイルが別のプログラムでロックされている
3. ネットワークドライブで応答が遅い

→ ログファイルでエラーを確認してください

### Q6: CSVファイルが文字化けする
**A**: 文字コードがUTF-8でない可能性があります
1. メモ帳で開く
2. 「名前を付けて保存」→ 文字コード「UTF-8」を選択
3. 保存してアプリケーションを再起動

---

## UI要素の説明

```
┌──────────────────────────────────────────────┐
│ 従業員No: [______] 読み込み中...             │ ← ①②③
│           山田太郎                            │ ← ④
│ カードNo: [______]                           │ ← ⑤
│ [照合] [キャンセル]                          │ ← ⑥⑦
│ カードNoを入力してください                   │ ← ⑧
│ ┌──────────────────────────────────────┐   │
│ │投入前10mm│投入後1mm│投入後5mm│...       │   │ ← ⑨
│ └──────────────────────────────────────┘   │
└──────────────────────────────────────────────┘

① 従業員No入力欄: 6桁の数字を入力
② ローディング表示: 検索中に表示（グレー、イタリック）
③ 従業員名表示: 氏名を青文字で表示（該当なし時は赤文字）
④ カードNo入力欄: 従業員NO入力後に活性化
⑤ 照合ボタン: カードNo入力後に活性化
⑥ キャンセルボタン: 全入力をクリア
⑦ メッセージエリア: 操作案内やエラーメッセージ
⑧ 使用部材条件表: カードNo該当時に表示
```

---

## トラブルシューティング

### エラーメッセージ別対処法

| エラーメッセージ | 原因 | 対処法 |
|----------------|------|--------|
| 該当するユーザがありません。 | CSVに従業員NOが未登録 | CSVファイルにデータを追加 |
| データ読み取りエラーが発生しました | ファイル未検出/読み取り失敗 | ファイルの存在と形式を確認 |
| 従業員Noは数字のみで入力してください | 数字以外を入力 | 数字のみで再入力 |

### 動作がおかしい場合の確認手順
1. **アプリケーションの再起動**
2. **CSVファイルの確認**
   - 存在するか
   - UTF-8か
   - 文法エラーがないか
3. **ログファイルの確認**
   - `logs\error\[日付].log`
4. **設定ファイルの確認**（高度）
   - `appsettings.json` の `EmployeeCsvPath` 設定

---

## パフォーマンスに関する注意

### 推奨データサイズ
- **最適**: 〜1,000件
- **許容**: 〜10,000件
- **上限**: 〜100,000件

### 大量データ使用時の注意
- 初回検索時に全データをメモリに読み込みます
- 検索自体は高速（Dictionary使用）
- 10万件を超える場合はデータベース移行を推奨

---

## サポート情報

### ドキュメント
- **実装詳細**: `IMPLEMENTATION.md`
- **テスト仕様**: `TEST_SPECIFICATION.md`
- **受け入れ基準**: `ACCEPTANCE_CRITERIA.md`
- **CSVファイル仕様**: `BalanceInspection/data/README.md`

### ログファイル
- **通常ログ**: `logs/[日付].csv`
- **エラーログ**: `logs/error/[日付].log`

---

## 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.0.0 | 2025-11-05 | 初版リリース - 従業員NOチェック機能追加 |

---

**この機能に関する詳細な技術仕様は `IMPLEMENTATION.md` を参照してください。**
